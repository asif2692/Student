<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Register - Student Portal</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-light">
  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-md-6">
        <div class="card shadow-sm">
          <div class="card-body">
            <h3 class="card-title text-center mb-3">
              <i class="fas fa-user-plus me-2"></i>Create Account
            </h3>
            <div class="mb-3">
              <label class="form-label">Full Name *</label>
              <input id="name" class="form-control" placeholder="Enter your full name" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Email *</label>
              <input id="email" type="email" class="form-control" placeholder="Enter your email" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Password *</label>
              <input id="password" type="password" class="form-control" placeholder="Create a password" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Role *</label>
              <select id="role" class="form-select" required>
                <option value="">Select Role</option>
                <option value="staff">Staff</option>
                <option value="campus_manager">Campus Manager</option>
                <option value="admin">Admin</option>
              </select>
            </div>
            <div class="mb-3">
              <label class="form-label">Campus</label>
              <select id="campus" class="form-select">
                <option value="campus-a">Campus A</option>
                <option value="campus-b">Campus B</option>
              </select>
            </div>
            <div class="d-flex justify-content-between">
              <button id="registerBtn" class="btn btn-primary">
                <i class="fas fa-user-plus me-1"></i>Register
              </button>
              <a href="index.html" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-1"></i>Back to Sign In
              </button>
            </div>
            <div class="alert alert-info mt-3" role="alert">
              <small>
                <i class="fas fa-info-circle me-1"></i>
                <strong>Note:</strong> For production, create admin accounts via Firebase Console for security.
              </small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="firebase-config.js"></script>
<script src="app-common.js"></script>
<script>
document.getElementById('registerBtn').onclick = async ()=>{
  const name = document.getElementById('name').value.trim();
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value;
  const role = document.getElementById('role').value;
  const campus = document.getElementById('campus').value;
  
  if(!name || !email || !password || !role){ 
    alert('Please fill all required fields'); 
    return; 
  }

  const registerBtn = document.getElementById('registerBtn');
  const originalText = registerBtn.innerHTML;
  registerBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Registering...';
  registerBtn.disabled = true;

  try{
    const userCred = await auth.createUserWithEmailAndPassword(email, password);
    const uid = userCred.user.uid;
    
    // âœ… FIXED: Correct variable name (userCred instead of uc)
    await db.collection('users').doc(uid).set({
      name: name,
      email: email,
      role: role,
      campusId: campus || "campus-a",
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });
    
    alert('Registration successful. Please sign in.');
    window.location.href = 'index.html';
  }catch(err){ 
    alert('Registration error: '+err.message); 
  } finally {
    registerBtn.innerHTML = originalText;
    registerBtn.disabled = false;
  }
}
</script>
</body>
</html>